{% extends "main.html" %}
{% load static %}
{% block styles %}
    <link href="{% static 'css/main_styles.css' %}" rel="stylesheet">
    <link href="{% static 'css/class_styles.css' %}" rel="stylesheet">
    <!-- jQuery import-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
{% endblock %}
{% block title %} {{ user.first_name }} {{ user.last_name }} {% endblock %}
{% block content %}
<div id="newLessonView">
        <div id="newLessonBox">
            <div id="newLessonHeader" style="font-size: 24px;">TWORZENIE NOWEJ LEKCJI</div>
            <form id="createNewLessonForm" method="post" action="/show-classrooms/display-classroom/{{ classroom.id }}/add-lesson">
              {% csrf_token %}
              {{ error }}
                <label for="nameOfLesson"><b>Tytuł lekcji:</b></label>
                <input id="nameOfLesson" class="createNewLessonInput" type="text" placeholder="Tytuł lekcji" name="lesson_name" maxlength="100" required>
                <label for="descriptionOfLesson"><b>Opis lekcji:</b></label>
                <textarea name="description" id="descriptionOfLesson" class="createNewLessonInput" placeholder="Opis lekcji" cols="30" rows="4" maxlength="250"></textarea>
                <label for="descriptionOfLessonNote"><b>Notatka do lekcji:</b></label>
                <textarea name="note" id="descriptionOfLessonNote" class="createNewLessonInput" placeholder="Notatka do lekcji" cols="30" rows="5" maxlength="1000"></textarea>
                <div>
                    <label for="startDate" class="rightLabel"><b>Data rozpoczęcia:</b></label>
                    <input id="startDate" class="createNewLessonInput" name="lesson_date" type="date" value="2021-05-26">
                </div>
                <div>
                    <label for="startHour" class="rightLabel"><b>Godzina rozpoczęcia:</b></label>
                    <input id="startHour" class="createNewLessonInput" name="lesson_hour" type="time" value="19:20">
                </div>
            <div id="buttonsSection" style="margin: auto; padding-top: 20px;">
                <button id="cancelCreatingNewLessonButton" class="createNewLessonButtons" style="background-color: #E74C3C;">
                    <svg id="exitJoinNewClassIcon" width="30" height="30" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M26.6876 8.32717C26.5527 8.19197 26.3924 8.08472 26.216 8.01153C26.0396 7.93835 25.8504 7.90068 25.6595 7.90068C25.4685 7.90068 25.2793 7.93835 25.1029 8.01153C24.9265 8.08472 24.7662 8.19197 24.6313 8.32717L17.5001 15.4438L10.3688 8.31258C10.2338 8.17757 10.0735 8.07047 9.89712 7.9974C9.72072 7.92433 9.53165 7.88672 9.34071 7.88672C9.14977 7.88672 8.9607 7.92433 8.78429 7.9974C8.60788 8.07047 8.4476 8.17757 8.31258 8.31258C8.17757 8.4476 8.07047 8.60788 7.9974 8.78429C7.92433 8.9607 7.88672 9.14977 7.88672 9.34071C7.88672 9.53165 7.92433 9.72072 7.9974 9.89712C8.07047 10.0735 8.17757 10.2338 8.31258 10.3688L15.4438 17.5001L8.31258 24.6313C8.17757 24.7663 8.07047 24.9266 7.9974 25.103C7.92433 25.2794 7.88672 25.4685 7.88672 25.6595C7.88672 25.8504 7.92433 26.0395 7.9974 26.2159C8.07047 26.3923 8.17757 26.5526 8.31258 26.6876C8.4476 26.8226 8.60788 26.9297 8.78429 27.0028C8.9607 27.0758 9.14977 27.1134 9.34071 27.1134C9.53165 27.1134 9.72072 27.0758 9.89712 27.0028C10.0735 26.9297 10.2338 26.8226 10.3688 26.6876L17.5001 19.5563L24.6313 26.6876C24.7663 26.8226 24.9266 26.9297 25.103 27.0028C25.2794 27.0758 25.4685 27.1134 25.6595 27.1134C25.8504 27.1134 26.0395 27.0758 26.2159 27.0028C26.3923 26.9297 26.5526 26.8226 26.6876 26.6876C26.8226 26.5526 26.9297 26.3923 27.0028 26.2159C27.0758 26.0395 27.1134 25.8504 27.1134 25.6595C27.1134 25.4685 27.0758 25.2794 27.0028 25.103C26.9297 24.9266 26.8226 24.7663 26.6876 24.6313L19.5563 17.5001L26.6876 10.3688C27.2417 9.81467 27.2417 8.88133 26.6876 8.32717Z" fill="#ffffff"/>
                    </svg><div class="createNewLessonButtonsDescription">Anuluj</div>
                </button>
                <button id="confirmCreatingNewLessonButton" class="createNewLessonButtons" style="background-color: #1BB55C;" type="submit">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 12L10 18L20 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg><div class="createNewLessonButtonsDescription" style="padding-left: 3px;">Stwórz</div>
                </button>
            </div>
            </form>
        </div>
    </div>
    <div class="tui-class_page">
        <div id="tui-class_box">
            <div id="nameOfTheClassBox">
                <div id="nameOfTheClass" contentEditable="false">
                    {{ classroom.name }} &emsp; <span style="font-size:12px;" id="messageBox"> </span>
                </div>
                <svg id="openCloseNameIcon" onclick="openCloseName()" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 10C3.9 10 3 10.9 3 12C3 13.1 3.9 14 5 14C6.1 14 7 13.1 7 12C7 10.9 6.1 10 5 10ZM19 10C17.9 10 17 10.9 17 12C17 13.1 17.9 14 19 14C20.1 14 21 13.1 21 12C21 10.9 20.1 10 19 10ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10Z" fill="black"/>
                </svg>
            </div>
            <div id="descriptionOfTheClassBox">
                <div id="descriptionOfTheClass" contentEditable="false">
                {{ classroom.subject }}
                </div>
                <svg id="openCloseDescriptionIcon" onclick="openCloseDescription()" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 10C3.9 10 3 10.9 3 12C3 13.1 3.9 14 5 14C6.1 14 7 13.1 7 12C7 10.9 6.1 10 5 10ZM19 10C17.9 10 17 10.9 17 12C17 13.1 17.9 14 19 14C20.1 14 21 13.1 21 12C21 10.9 20.1 10 19 10ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10Z" fill="black"/>
                </svg>
            </div>
            <div id="bottomClassContainer">
                <div id="leftPartOfBottomClassContainer">
                    <div id="listOfClassLessonsBox" class="bottom_class_box">
                        <div style="font-size: 20px; padding-left: 4px;">Spis lekcji</div>
                        {% if user.is_teacher %}
                        <button id="addLessonButton" class="class_button">
                                <svg id="addLessonIcon" width="16" height="18" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="white">
                                <path d="M8 0C8.26522 0 8.51957 0.105357 8.70711 0.292893C8.89464 0.48043 9 0.734784 9 1V7H15C15.2652 7 15.5196 7.10536 15.7071 7.29289C15.8946 7.48043 16 7.73478 16 8C16 8.26522 15.8946 8.51957 15.7071 8.70711C15.5196 8.89464 15.2652 9 15 9H9V15C9 15.2652 8.89464 15.5196 8.70711 15.7071C8.51957 15.8946 8.26522 16 8 16C7.73478 16 7.48043 15.8946 7.29289 15.7071C7.10536 15.5196 7 15.2652 7 15V9H1C0.734784 9 0.48043 8.89464 0.292893 8.70711C0.105357 8.51957 0 8.26522 0 8C0 7.73478 0.105357 7.48043 0.292893 7.29289C0.48043 7.10536 0.734784 7 1 7H7V1C7 0.734784 7.10536 0.48043 7.29289 0.292893C7.48043 0.105357 7.73478 0 8 0V0Z"/>
                                </svg>DODAJ LEKCJĘ
                            </button>
                        {% endif %}
                        {% if lessons|length == 0 %}
                          <p>Brak lekcji dla tej klasy</p>
                        {% else %}
                        {% for lesson in lessons %}
                          <div class="class_from_list" onclick="document.location='/show-classrooms/display-classroom/{{ classroom.id }}/display-lesson/{{ lesson.id }}'">

                              <div class="name_of_class_from_list">{{lesson.id}} {{lesson.subject}}</div>
                              {% if lesson.date != None %}
                              <div class="date_of_class_from_list">{{lesson.date}}</div>
                              {% else %}
                              <div class="date_of_class_from_list">Nie przypisano daty</div>
                              {% endif %}
                          </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
                <div id="rightPartOfBottomClassContainer">
                    <div id="listOfClassStudentsBox" class="bottom_class_box">
                        <div style="font-size: 20px; border-bottom: 1px solid #DFE2E0; margin-bottom: 4px;">Uczniowie w klasie:</div>
                        {% for student in students %}
                        <div class="student_from_list">{{ student.first_name }} {{student.last_name}}
                            <input id="{{ student.id }}" type="checkbox" class="delete_checkbox" name="scales" unchecked>
                        </div>
                        {% endfor %}
                        {% if user.is_teacher == True %}
                        <button id="deleteStudentsFromClassButton" onclick="deleteStudents()">USUŃ UCZNIA</button>
                        <button id="dontDeleteStudentsFromClassButton" onclick="dontDeleteStudents()">ANULUJ</button>
                        <button id="confirmDeletingStudentsFromClassButton" onclick="confirmDeletingStudents()">POTWIERDŹ</button>
                        {% endif %}
                    </div>
                    <div id="classInfoContainer">
                        <div class="class_info">Min. wiek uczniów w klasie:
                            <input name="age_range_min" id="minNumberOfStudentsInClass" class="class_info_input" type="number" disabled="true" value="{{ classroom.age_range_min }}" min="1">
                        </div>
                        <div class="class_info">Max. wiek uczniów w klasie:
                            <input name="age_range_max" id="maxNumberOfStudentsInClass" class="class_info_input" type="number" disabled="true" value="{{ classroom.age_range_max }}" max="99">
                        </div>
                        <div class="class_info">Planowane rozpoczęcie zajęć:
                            <input name="time_frame_start" id="startDateOfClass" class="class_date_input" type="date" disabled="true" value="{{ classroom.time_frame_start|date:'Y-m-d' }}" required/>
                        </div>
                        <div class="class_info">Planowane zakończenie zajęć:
                            <input name="time_frame_end" id="endDateOfClass" class="class_date_input" type="date" disabled="true" value="{{ classroom.time_frame_end|date:'Y-m-d' }}" required/>
                        </div>
                        <button type="submit" id="saveClassButton" class="class_button" style="background-color: #1BB55C;" onclick="saveContent()">ZAPISZ</button>
                    </div>
                    {% if user.is_teacher == True %}
                    <button id="deleteClassButton" class="class_button" style="background-color: #E74C3C;" onclick="deleteClass()">USUŃ KLASĘ</button>
                    <button id="editClassButton" class="class_button" style="background-color: #0E4DA4;" onclick="editContent()">EDYTUJ DANE</button>
                    <p id=askDeleteClass style="color: #E74C3C; display: none;"><br>
                      Czy na pewno chcesz usunąć klasę?</p>
                    <button id="dontDeleteClassButton" onclick="dontDeleteClass()">ANULUJ</button>
                    <button id="confirmDeletingClassButton" class="class_button" onclick="document.location='./delete-classroom/{{ classroom.id }}'" style="background-color: #E74C3C;">POTWIERDŹ</button>
                    {% endif %}
                    <div id="lessonMessages">

                      </div>
                </div>
            </div>
            <div id="codeOfClass">Kod klasy: {{ classroom.classroom_id }}</div>
        </div>
    </div>

    <script>
           $(document).ready(function(){
               $("#addLessonButton").click(function(){
                   console.log("hahaha");
                   $("#newLessonView").slideDown();
               });
               $("#cancelCreatingNewLessonButton").click(function(){
                   console.log("bububu");
                   $("#newLessonView").slideUp();
               });
           });
    </script>
    <script>
        function highlightTab() {
            var tab = document.getElementById("classesButton");
            tab.style.borderBottom = "4px solid white";
        }

        function openCloseName() {
            var name = document.getElementById("nameOfTheClass");
            if (name.style.height == "auto") {
                name.style.height = "25px";
            } else {
                name.style.height = "auto";
            }
        }

        function openCloseDescription() {
            var desc = document.getElementById("descriptionOfTheClass");
            if (desc.style.height == "auto") {
                desc.style.height = "42px";
            } else {
                desc.style.height = "auto";
            }
        }

        function editContent() {
            var name = document.getElementById("nameOfTheClass");
            var desc = document.getElementById("descriptionOfTheClass");
            var min = document.getElementById("minNumberOfStudentsInClass");
            var max = document.getElementById("maxNumberOfStudentsInClass");
            var start = document.getElementById("startDateOfClass");
            var end = document.getElementById("endDateOfClass");
            var edit = document.getElementById("editClassButton");
            var save = document.getElementById("saveClassButton");

            save.style.display = "block";
            edit.style.backgroundColor = "#7693d8"
            edit.style.display = "none";
            name.contentEditable = "true";
            desc.contentEditable = "true";
            min.disabled = false;
            max.disabled = false;
            start.disabled = false;
            end.disabled = false;
        }

        function saveContent() {
            var name = document.getElementById("nameOfTheClass");
            var desc = document.getElementById("descriptionOfTheClass");
            var min = document.getElementById("minNumberOfStudentsInClass");
            var max = document.getElementById("maxNumberOfStudentsInClass");
            var start = document.getElementById("startDateOfClass");
            var end = document.getElementById("endDateOfClass");
            var edit = document.getElementById("editClassButton");
            var save = document.getElementById("saveClassButton");

            let form_data = {class_name: name.innerHTML,
                            subject: desc.innerHTML,
                            age_range_min: min.value,
                            age_range_max: max.value,
                            time_frame_start: start.value,
                            time_frame_end: end.value,
                            csrfmiddlewaretoken: '{{ csrf_token }}'};

                            console.log(form_data);
                            $.ajax({
                                'method': 'POST',
                                'url': '/show-classrooms/display-classroom/{{ classroom.id }}',
                                'data': form_data,
                                'success': function(){
                                    $("#classMessages").html("Klasa została pomyślnie edytowana");
                                },
                                'error': function(){
                                    $("#classMessages").html("Nie udało się edytować klasy!");
                                }
                            });

            save.style.display = "none";
            edit.style.backgroundColor = "#375eb9";
            name.contentEditable = "false";
            desc.contentEditable = "false";
            min.disabled = true;
            max.disabled = true;
            start.disabled = true;
            end.disabled = true;
        }

        function deleteStudents() {
            var checks = document.getElementsByClassName('delete_checkbox');
            var deleting = document.getElementById("deleteStudentsFromClassButton");
            var dont = document.getElementById("dontDeleteStudentsFromClassButton");
            var confirm = document.getElementById("confirmDeletingStudentsFromClassButton");
            console.log(checks)
            for (var i = 0; i < checks.length; i++) {
                checks[i].style.display = 'block';
            }
            deleting.style.display = "none";
            dont.style.display = 'block';
            confirm.style.display = 'block';
        }

        function dontDeleteStudents() {
            var checks = document.getElementsByClassName('delete_checkbox');
            var deleting = document.getElementById("deleteStudentsFromClassButton");
            var dont = document.getElementById("dontDeleteStudentsFromClassButton");
            var confirm = document.getElementById("confirmDeletingStudentsFromClassButton");
            console.log(checks)
            for (var i = 0; i < checks.length; i++) {
                checks[i].style.display = 'none';
            }
            deleting.style.display = "block";
            dont.style.display = 'none';
            confirm.style.display = 'none';
        }

        function confirmDeletingStudents() {
            let checks = document.getElementsByClassName('delete_checkbox');
            let deleting = document.getElementById("deleteStudentsFromClassButton");
            let dont = document.getElementById("dontDeleteStudentsFromClassButton");
            let confirm = document.getElementById("confirmDeletingStudentsFromClassButton");
            console.log(checks);
            let marked = [];
            for (let i = 0; i < checks.length; i++) {
                if(checks[i].checked){
                    marked.push(checks[i])
                }
                checks[i].style.display = 'none';
                checks[i].checked = false;
            }
            i = 0;
            for(i; i < marked.length; i++){
                let student_id = marked[i].id;
                console.log(student_id);
                $.ajax({
                    'method': 'POST',
                    'url': '/show-classrooms/display-classroom/{{ classroom.id }}/students/'+student_id+'/delete',
                    'data': {csrfmiddlewaretoken: '{{ csrf_token }}'},
                    'success': function(result){
                        let mssg = result.mssg;
                        $("#messageBox").html(mssg);
                    },
                    'error': function(result){
                            let error = result.mssg;
                            $("#messageBox").html(error);
                    }
                });
                $("#"+student_id).parent().css("display", "none");
            }

            deleting.style.display = "block";
            dont.style.display = 'none';
            confirm.style.display = 'none';
        }

        function deleteClass() {
            var deleting = document.getElementById("deleteClassButton");
            var dont = document.getElementById("dontDeleteClassButton");
            var confirm = document.getElementById("confirmDeletingClassButton");
            var ask = document.getElementById("askDeleteClass");
            deleting.style.display = "none";
            dont.style.display = 'inline-block';
            confirm.style.display = 'inline-block';
            ask.style.display = 'block';
        }

        function dontDeleteClass() {
            var deleting = document.getElementById("deleteClassButton");
            var dont = document.getElementById("dontDeleteClassButton");
            var confirm = document.getElementById("confirmDeletingClassButton");
            var ask = document.getElementById("askDeleteClass");
            deleting.style.display = "inline-block";
            dont.style.display = 'none';
            confirm.style.display = 'none';
            ask.style.display = 'none';
        }

        function confirmDeletingClass() {
            window.location.href = "./notification.html";
        }

        highlightTab();
    </script>
  {% endblock %}
